{
	"name": "SoldierController",
	"events": [
		{
			"functionName": "SpawnSoldiers",
			"functionDescription": "Function to spawn all soldiers in a defined order.",
			"functionCategory": "Soldier",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "SourceZoneUID",
					"type": "number",
					"initialValue": "0",
					"comment": "UID of Zone from which to spawn soldiers",
					"sid": 813322902019269
				},
				{
					"name": "DestinationZoneUID",
					"type": "number",
					"initialValue": "0",
					"comment": "UID of zone to send soldiers to",
					"sid": 899037124483783
				},
				{
					"name": "colourToSpawn",
					"type": "string",
					"initialValue": "",
					"comment": "Color of soldier to spawn (case sensitive string; red/blue)",
					"sid": 499903808441665
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 570286372935914,
			"children": [
				{
					"eventType": "variable",
					"name": "sourceX",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 122810105832752
				},
				{
					"eventType": "variable",
					"name": "sourceY",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 798039579189425
				},
				{
					"eventType": "variable",
					"name": "destinationX",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 219064375489905
				},
				{
					"eventType": "variable",
					"name": "destinationY",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 382789822522994
				},
				{
					"eventType": "variable",
					"name": "angleBetweenZones",
					"type": "number",
					"initialValue": "0",
					"comment": "Angle between the source and destination zones",
					"isStatic": false,
					"isConstant": false,
					"sid": 167747447508900
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "pick-by-unique-id",
							"objectClass": "Zone",
							"sid": 202437437784145,
							"parameters": {
								"unique-id": "SourceZoneUID"
							}
						},
						{
							"id": "pick-children",
							"objectClass": "Zone",
							"sid": 854380558965514,
							"parameters": {
								"child": "ZoneCenter",
								"which": "own"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 320094532277853,
							"parameters": {
								"variable": "sourceX",
								"value": "ZoneCenter.X"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 641330030090766,
							"parameters": {
								"variable": "sourceY",
								"value": "ZoneCenter.Y"
							}
						}
					],
					"sid": 394888007548370
				},
				{
					"eventType": "comment",
					"text": "Pick only works from the last pool of picked items. Hence to pick something that was excluded in the last pick, I reset the pick by \"pick all\", and then picked what I wanted to pick"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "pick-all",
							"objectClass": "System",
							"sid": 192563491155358,
							"parameters": {
								"object": "Zone"
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "Zone",
							"sid": 447297761481569,
							"parameters": {
								"unique-id": "DestinationZoneUID"
							}
						},
						{
							"id": "pick-children",
							"objectClass": "Zone",
							"sid": 545313401878663,
							"parameters": {
								"child": "ZoneCenter",
								"which": "own"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 922476750684839,
							"parameters": {
								"variable": "destinationX",
								"value": "ZoneCenter.X"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 521896562203018,
							"parameters": {
								"variable": "destinationY",
								"value": "ZoneCenter.Y"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 700060491752297,
							"parameters": {
								"variable": "angleBetweenZones",
								"value": "angle(sourceX, sourceY, destinationX, destinationY)"
							}
						},
						{
							"id": "set-text",
							"objectClass": "DebugText",
							"sid": 651166145442320,
							"parameters": {
								"text": "angleBetweenZones"
							}
						}
					],
					"sid": 328834105555371
				},
				{
					"eventType": "variable",
					"name": "soldiersLeftToSpawn",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 821298378253479
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "pick-by-comparison",
							"objectClass": "System",
							"sid": 698342504345180,
							"parameters": {
								"object": "Player",
								"expression": "Player.PlayerColor",
								"comparison": 0,
								"value": "colourToSpawn"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 404192256440071,
							"parameters": {
								"variable": "soldiersLeftToSpawn",
								"value": "Zone.CurrentlyHolding"
							}
						}
					],
					"sid": 509174785033360,
					"children": [
						{
							"eventType": "variable",
							"name": "offset",
							"type": "number",
							"initialValue": "0",
							"comment": "Spawn Offset distance from center for this particular soldier",
							"isStatic": false,
							"isConstant": false,
							"sid": 820779681790047
						},
						{
							"eventType": "variable",
							"name": "repeatLoopIndex",
							"type": "number",
							"initialValue": "0",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 571615585158767
						},
						{
							"eventType": "comment",
							"text": "We have to spawn soldiers in batches. So we divide the soldiers in X batches, each of Y size. Eg. if CurrentlyHolding of Zone = 30, and spawn batch size is 5, then we spawn 6 batches of 5 size each. If batch size is 4, then we spawn 7 batches of size 4 each, and then last batch of 2 soldiers."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "repeat",
									"objectClass": "System",
									"sid": 637439136746956,
									"parameters": {
										"count": "floor(Zone.CurrentlyHolding / Player.SpawnBatchSize) + 1"
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 155950972304657,
									"parameters": {
										"variable": "repeatLoopIndex",
										"value": "loopindex"
									}
								}
							],
							"sid": 699325807862175,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "for",
											"objectClass": "System",
											"sid": 788385891715721,
											"parameters": {
												"name": "\"Spawn\"",
												"start-index": "0",
												"end-index": "min(Player.SpawnBatchSize - 1, soldiersLeftToSpawn-1)"
											}
										}
									],
									"actions": [
										{
											"id": "set-eventvar-value",
											"objectClass": "System",
											"sid": 799091367176642,
											"parameters": {
												"variable": "offset",
												"value": "(loopindex(\"Spawn\") - (Player.SpawnBatchSize/2)) * Soldier.Height"
											}
										},
										{
											"id": "create-object",
											"objectClass": "System",
											"sid": 671662047502440,
											"parameters": {
												"object-to-create": "Soldier",
												"layer": "0",
												"x": "sourceX - (offset * sin(angleBetweenZones))",
												"y": "sourceY + (offset * cos(angleBetweenZones))",
												"create-hierarchy": false,
												"template-name": "\"Soldier\""
											}
										},
										{
											"id": "append-text",
											"objectClass": "DebugText",
											"sid": 467790550080662,
											"parameters": {
												"text": "loopindex(\"Spawn\") & \" : \""
											}
										},
										{
											"id": "subtract-from-eventvar",
											"objectClass": "System",
											"sid": 994879867186263,
											"parameters": {
												"variable": "soldiersLeftToSpawn",
												"value": "1"
											}
										},
										{
											"id": "set-visible",
											"objectClass": "Soldier",
											"sid": 202061472399867,
											"parameters": {
												"visibility": "invisible"
											}
										},
										{
											"id": "set-angle",
											"objectClass": "Soldier",
											"sid": 508485446847344,
											"parameters": {
												"angle": "angleBetweenZones"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Soldier",
											"sid": 343880459201881,
											"parameters": {
												"instance-variable": "sourceZoneUID",
												"value": "SourceZoneUID"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Soldier",
											"sid": 437829084483574,
											"parameters": {
												"instance-variable": "destinationZoneUID",
												"value": "DestinationZoneUID"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Soldier",
											"sid": 429812670997234,
											"parameters": {
												"instance-variable": "destX",
												"value": "destinationX"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Soldier",
											"sid": 483286270768289,
											"parameters": {
												"instance-variable": "destY",
												"value": "destinationY"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Soldier",
											"sid": 395331929479757,
											"parameters": {
												"instance-variable": "BelongsTo",
												"value": "Player.PlayerColor"
											}
										},
										{
											"id": "set-animation",
											"objectClass": "Soldier",
											"sid": 620011507462520,
											"parameters": {
												"animation": "Soldier.BelongsTo",
												"from": "beginning"
											}
										},
										{
											"id": "start-timer",
											"objectClass": "Soldier",
											"sid": 904204199275830,
											"disabled": true,
											"behaviorType": "Timer",
											"parameters": {
												"duration": "repeatLoopIndex * Player.SpawnFrequency",
												"type": "once",
												"tag": "str(Soldier.UID)"
											}
										},
										{
											"id": "wait",
											"objectClass": "System",
											"sid": 821437512121310,
											"parameters": {
												"seconds": "repeatLoopIndex * Player.SpawnFrequency"
											}
										},
										{
											"id": "set-visible",
											"objectClass": "Soldier",
											"sid": 288327285942811,
											"parameters": {
												"visibility": "visible"
											}
										},
										{
											"id": "set-max-speed",
											"objectClass": "Soldier",
											"sid": 435849649825215,
											"behaviorType": "MoveTo",
											"parameters": {
												"max-speed": "Player.SoldierTravelSpeed"
											}
										},
										{
											"id": "move-to-position",
											"objectClass": "Soldier",
											"sid": 460007047450539,
											"behaviorType": "MoveTo",
											"parameters": {
												"x": "Self.destX",
												"y": "Self.destY",
												"mode": "direct"
											}
										},
										{
											"callFunction": "ReduceFromZone",
											"sid": 769744168889254,
											"parameters": [
												"Soldier.sourceZoneUID"
											]
										}
									],
									"sid": 291612873555968
								}
							]
						}
					]
				}
			]
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-timer",
					"objectClass": "Soldier",
					"sid": 739015770256732,
					"behaviorType": "Timer",
					"parameters": {
						"tag": "str(Soldier.UID)"
					}
				}
			],
			"actions": [
				{
					"id": "set-visible",
					"objectClass": "Soldier",
					"sid": 132233558530485,
					"parameters": {
						"visibility": "visible"
					}
				},
				{
					"id": "set-max-speed",
					"objectClass": "Soldier",
					"sid": 817399459534935,
					"behaviorType": "MoveTo",
					"parameters": {
						"max-speed": "Player.SoldierTravelSpeed"
					}
				},
				{
					"id": "move-to-position",
					"objectClass": "Soldier",
					"sid": 961056235087184,
					"behaviorType": "MoveTo",
					"parameters": {
						"x": "Self.destX",
						"y": "Self.destY",
						"mode": "direct"
					}
				},
				{
					"id": "append-text",
					"objectClass": "DebugText",
					"sid": 205622690517186,
					"parameters": {
						"text": "Soldier.UID & \" - \""
					}
				},
				{
					"callFunction": "ReduceFromZone",
					"sid": 164779255787387,
					"parameters": [
						"Soldier.sourceZoneUID"
					]
				}
			],
			"sid": 878517177578509,
			"disabled": true
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-arrived",
					"objectClass": "Soldier",
					"sid": 937276090004388,
					"behaviorType": "MoveTo"
				},
				{
					"id": "is-overlapping-another-object",
					"objectClass": "Soldier",
					"sid": 162016278033794,
					"parameters": {
						"object": "Zone"
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Soldier",
					"sid": 791411463738693,
					"parameters": {
						"instance-variable": "destinationZoneUID",
						"comparison": 0,
						"value": "Zone.UID"
					}
				}
			],
			"actions": [
				{
					"callFunction": "SoldierArrivedAtZone",
					"sid": 826074703157447,
					"parameters": [
						"Soldier.UID",
						"Zone.UID"
					]
				},
				{
					"id": "destroy",
					"objectClass": "Soldier",
					"sid": 207907930372860
				}
			],
			"sid": 611870114922696
		}
	],
	"sid": 484126003790637
}